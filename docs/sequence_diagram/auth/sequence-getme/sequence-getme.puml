@startuml Get Current User (GET)

header Restaurant Reservation System Sequence Diagram
footer Page %page% of %lastpage%
title "Get Current User (GET)"

participant "Client" as client
participant "<<javaScript>>\n:server" as server
participant "<<router>>\n:auth" as routerAuth
participant "<<middleware>>\n:auth" as middlewareAuth
participant "<<controllers>>\n:auth" as controllersAuth
participant "<<model>>\n:User" as modelUser
database "<<MongoDB>>\n:users" as UsersDatabase

client->server ++:req.get('/api/v1/auth/me')\nAuthorization: Bearer <token>
server->routerAuth ++:app.use('/api/v1/auth',auth)
routerAuth -> middlewareAuth ++:protect()
middlewareAuth->middlewareAuth:extract token from header/cookie
middlewareAuth->middlewareAuth:jwt.verify(token)
middlewareAuth->modelUser ++:findById(decoded.id)
modelUser ->UsersDatabase ++: UserSchema
UsersDatabase --> modelUser --: user
middlewareAuth <-- modelUser --:user
alt user not found or invalid token
    middlewareAuth->client --:401 - Not authorized
else token valid
    middlewareAuth->routerAuth --:next()
    routerAuth -> controllersAuth ++:getMe()
    controllersAuth->modelUser ++:findById(req.user.id)
    modelUser ->UsersDatabase ++: UserSchema
    UsersDatabase --> modelUser --: user
    controllersAuth <-- modelUser --:user
    controllersAuth->client --:200 - User data\n{success: true, data: user}
end

@enduml